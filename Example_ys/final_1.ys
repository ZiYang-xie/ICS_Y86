.define graph $0xe00
.define flag $0xdf8
.define console $0xf00
.define red    $0xff000080 # to 0xffff0000
.define orange $0xf9100080 # to 0xffff9100
.define yellow $0xfbff0080 # to 0xfffbff00
.define green  $0x26ff0080 # to 0xfffbff00

.pos 0
irmovq str %rdi
irmovq console %rsi
mrmovq (%rdi) %rax
rmmovq %rax console
iaddq $8 %rdi
iaddq $8 %rsi
mrmovq (%rdi) %rax
rmmovq %rax (%rsi)
irmovq $0 %rdi
irmovq $0 %rax
irmovq $0 %rbx
irmovq graph %rsp
irmovq $0 %rsi
loop:
    irmovq $0 %rcx
    mrmovq color(%rsi) %rax
    eachline:
        rmmovl %rax (%rsp)
        iaddq $4 %rsp
        iaddq $1 %rcx
        iaddq $10 %rax
        rmmovq %rbx flag #翻转flag
        icmpq $8 %rcx
        jl eachline
    iaddq $4 %rsi
    icmpq $32 %rsi
    jl loop
halt

.align 8
color:
    .word red
    .word red
    .word orange
    .word orange
    .word yellow
    .word yellow
    .word green
    .word green
    .word green
.align 8
str:
    .string "hello,world!\n"
.byte 0
